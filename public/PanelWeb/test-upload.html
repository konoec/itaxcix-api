<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Upload de Foto de Perfil</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-container {
            border: 2px solid #ddd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px solid #ddd;
            object-fit: cover;
        }
        .change-photo-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
        .change-photo-btn:hover {
            background: #0056b3;
        }
        .change-photo-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .profile-loading {
            opacity: 0.5;
        }
        .avatar-loading {
            opacity: 0.5;
        }
        .test-log {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Upload de Foto de Perfil</h1>
    
    <div class="test-container">
        <h2>Elementos de Perfil</h2>
        
        <!-- Imagen de perfil principal (simulando topbar) -->
        <div id="profile-container" style="cursor: pointer; border: 1px solid #ccc; padding: 10px; display: inline-block;">
            <img id="profile-image" class="profile-image" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjUwIiBmaWxsPSIjNjM3M2QwIi8+CjxjaXJjbGUgY3g9IjUwIiBjeT0iNDAiIHI9IjE1IiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMjAgODBjMC0xNi41NjkgMTMuNDMxLTMwIDMwLTMwczMwIDEzLjQzMSAzMCAzMCIgZmlsbD0id2hpdGUiLz4KPC9zdmc+" alt="Perfil">
            <span id="user-display">Admin</span>
        </div>
    </div>

    <!-- Modal de perfil simulado -->
    <div id="profile-modal" class="test-container" style="display: none;">
        <h2>
            Mi Perfil
            <button id="close-profile-modal" style="float: right;">&times;</button>
        </h2>
        
        <div class="admin-profile-details">
            <div class="admin-profile-header">
                <div class="avatar-large">
                    <img id="profile-modal-avatar" class="profile-image" src="" alt="Foto de perfil" style="width: 150px; height: 150px;">
                    <div class="avatar-overlay">
                        <button class="change-photo-btn" id="change-photo-btn" title="Cambiar foto">
                            üì∑ Cambiar foto
                        </button>
                    </div>
                    <input type="file" id="photo-input" accept="image/*" style="display: none;">
                </div>
                
                <div class="admin-profile-header-info">
                    <h3 id="profile-modal-name">Nombre del Usuario</h3>
                </div>
            </div>
            
            <div class="admin-profile-info">
                <div class="info-item">
                    <label>Nombre:</label>
                    <span id="profile-modal-firstname">Test</span>
                </div>
                <div class="info-item">
                    <label>Apellido:</label>
                    <span id="profile-modal-lastname">User</span>
                </div>
                <div class="info-item">
                    <label>Email:</label>
                    <span id="profile-modal-email">test@example.com</span>
                </div>
                <div class="info-item">
                    <label>Tel√©fono:</label>
                    <span id="profile-modal-phone">+1234567890</span>
                </div>
            </div>
        </div>
    </div>

    <div class="test-container">
        <h2>Controles de Test</h2>
        <button onclick="showModal()">üîç Abrir Modal de Perfil</button>
        <button onclick="testPhotoUpload()">üì∑ Test Upload Directo</button>
        <button onclick="clearLog()">üßπ Limpiar Log</button>
    </div>

    <div class="test-container">
        <h2>Log de Actividad</h2>
        <div id="test-log" class="test-log">Iniciando test...\n</div>
    </div>

    <!-- Scripts necesarios -->
    <script src="../../assets/js/api/services/profile-service.js"></script>
    <script src="../../assets/js/ui/controllers/profile-controller.js"></script>
    
    <script>
        // Mock de sessionStorage para test
        sessionStorage.setItem('userId', 'test-user-123');
        sessionStorage.setItem('userFullName', 'Usuario de Prueba');
        sessionStorage.setItem('firstName', 'Usuario');
        sessionStorage.setItem('lastName', 'Prueba');
        
        let profileController;
        
        function log(message) {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('test-log').textContent = '';
        }
        
        function showModal() {
            const modal = document.getElementById('profile-modal');
            modal.style.display = 'block';
            log('üìã Modal abierto manualmente');
        }
        
        function testPhotoUpload() {
            const input = document.getElementById('photo-input');
            input.click();
            log('üìÅ Selector de archivo abierto manualmente');
        }
        
        // Inicializar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ DOM cargado, inicializando ProfileController...');
            
            try {
                profileController = new ProfileController();
                log('‚úÖ ProfileController inicializado');
            } catch (error) {
                log('‚ùå Error al inicializar ProfileController: ' + error.message);
                console.error(error);
            }
        });
        
        // Interceptar logs de console para mostrarlos en la p√°gina
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ');
            if (message.includes('üì∏') || message.includes('üîß') || message.includes('üìã') || 
                message.includes('üöÄ') || message.includes('‚ùå') || message.includes('‚úÖ')) {
                const logElement = document.getElementById('test-log');
                if (logElement) {
                    const timestamp = new Date().toLocaleTimeString();
                    logElement.textContent += `[${timestamp}] ${message}\n`;
                    logElement.scrollTop = logElement.scrollHeight;
                }
            }
        };
    </script>

    <!-- Toast notification for password recovery -->
    <div id="recovery-toast" class="recovery-toast">
        <div class="recovery-toast-content">
            <i class="fas fa-check-circle"></i>
            <span id="recovery-toast-message">Foto de perfil actualizada correctamente</span>
        </div>
    </div>
</body>
</html>
