<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Integraci√≥n - Sistema de Permisos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #b8daff;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .module-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .module-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .module-item.enabled {
            border-left-color: #28a745;
        }
        .module-item.disabled {
            border-left-color: #dc3545;
            opacity: 0.7;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Prueba de Integraci√≥n - Sistema de Permisos</h1>
        
        <div class="test-section">
            <h3>1. Verificaci√≥n de Archivos</h3>
            <button onclick="testFileIntegrity()">Verificar Archivos</button>
            <div id="file-results"></div>
        </div>

        <div class="test-section">
            <h3>2. Simulaci√≥n de Permisos</h3>
            <button onclick="testAllPermissions()">Probar Todos los Permisos</button>
            <button onclick="testLimitedPermissions()">Probar Permisos Limitados</button>
            <button onclick="testNoPermissions()">Probar Sin Permisos</button>
            <div id="permission-results"></div>
        </div>

        <div class="test-section">
            <h3>3. Verificaci√≥n de M√≥dulos</h3>
            <button onclick="testModuleIntegration()">Verificar M√≥dulos</button>
            <div id="module-results"></div>
        </div>

        <div class="test-section">
            <h3>4. Prueba de Navegaci√≥n</h3>
            <button onclick="testNavigationRoutes()">Probar Rutas</button>
            <div id="navigation-results"></div>
        </div>

        <div class="test-section">
            <h3>5. Estado del Sistema</h3>
            <button onclick="showSystemStatus()">Mostrar Estado del Sistema</button>
            <div id="system-status"></div>
        </div>
    </div>

    <script>
        // Lista de m√≥dulos de tablas maestras que deben estar configurados
        const expectedModules = [
            'Companies', 'Configuration', 'District', 'Departaments', 'Province',
            'UserStatus', 'UserCodeType', 'DriverStatus', 'ContactTypes', 'DocumentTypes',
            'Brand', 'VehicleModel', 'VehicleClass', 'Color', 'FuelType', 'Category',
            'ServiceType', 'ProcedureTypes', 'TravelStatus', 'TucModality', 'TucStatus',
            'IncidentType', 'InfractionSeverity', 'InfractionStatus'
        ];

        // Funci√≥n para mostrar resultados
        function showResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            container.appendChild(div);
        }

        // Funci√≥n para limpiar resultados
        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        // Verificar integridad de archivos
        async function testFileIntegrity() {
            clearResults('file-results');
            
            const files = [
                '../assets/js/auth/permissions.js',
                '../assets/js/auth/auth.js',
                '../assets/js/auth/route-guard.js',
                '../assets/components/sidebar.html'
            ];

            for (const file of files) {
                try {
                    const response = await fetch(file);
                    if (response.ok) {
                        showResult('file-results', `‚úÖ ${file} - OK`, 'success');
                    } else {
                        showResult('file-results', `‚ùå ${file} - Error ${response.status}`, 'error');
                    }
                } catch (error) {
                    showResult('file-results', `‚ùå ${file} - Error de red`, 'error');
                }
            }
        }

        // Simular permisos completos
        function testAllPermissions() {
            clearResults('permission-results');
            
            const allPermissions = [
                'TABLAS MAESTRAS',
                'ADMISI√ìN DE CONDUCTORES',
                'AUDITORIA',
                'CONFIGURACI√ìN'
            ];

            // Simular sesi√≥n con todos los permisos
            sessionStorage.setItem('userPermissions', JSON.stringify(allPermissions));
            sessionStorage.setItem('isLoggedIn', 'true');
            sessionStorage.setItem('authToken', 'test-token');
            sessionStorage.setItem('loginTime', Date.now().toString());
            
            showResult('permission-results', `‚úÖ Permisos simulados: ${allPermissions.join(', ')}`, 'success');
            
            // Verificar que los m√≥dulos est√©n disponibles
            if (window.PermissionsService) {
                const availableModules = window.PermissionsService.getAvailableModules();
                showResult('permission-results', `üìã M√≥dulos disponibles: ${availableModules.length}`, 'info');
            } else {
                showResult('permission-results', `‚ö†Ô∏è PermissionsService no disponible`, 'warning');
            }
        }

        // Simular permisos limitados
        function testLimitedPermissions() {
            clearResults('permission-results');
            
            const limitedPermissions = ['TABLAS MAESTRAS'];

            sessionStorage.setItem('userPermissions', JSON.stringify(limitedPermissions));
            sessionStorage.setItem('isLoggedIn', 'true');
            sessionStorage.setItem('authToken', 'test-token');
            sessionStorage.setItem('loginTime', Date.now().toString());
            
            showResult('permission-results', `‚úÖ Permisos limitados simulados: ${limitedPermissions.join(', ')}`, 'success');
            
            if (window.PermissionsService) {
                const availableModules = window.PermissionsService.getAvailableModules();
                showResult('permission-results', `üìã M√≥dulos disponibles: ${availableModules.length}`, 'info');
            }
        }

        // Simular sin permisos
        function testNoPermissions() {
            clearResults('permission-results');
            
            sessionStorage.setItem('userPermissions', JSON.stringify([]));
            sessionStorage.setItem('isLoggedIn', 'true');
            sessionStorage.setItem('authToken', 'test-token');
            sessionStorage.setItem('loginTime', Date.now().toString());
            
            showResult('permission-results', `‚ö†Ô∏è Sin permisos simulados`, 'warning');
            
            if (window.PermissionsService) {
                const availableModules = window.PermissionsService.getAvailableModules();
                showResult('permission-results', `üìã M√≥dulos disponibles: ${availableModules.length}`, 'info');
            }
        }

        // Verificar integraci√≥n de m√≥dulos
        function testModuleIntegration() {
            clearResults('module-results');
            
            const moduleList = document.createElement('div');
            moduleList.className = 'module-list';
            
            expectedModules.forEach(module => {
                const moduleItem = document.createElement('div');
                moduleItem.className = 'module-item';
                
                // Verificar si existe la p√°gina HTML
                const htmlPath = `../pages/MasterTables/${module}.html`;
                // Verificar si existe el inicializador JS
                const jsPath = `../assets/js/ui/initializers/MasterTables/${module.toLowerCase().replace(/([A-Z])/g, '-$1').substring(1)}-initializer.js`;
                
                moduleItem.innerHTML = `
                    <strong>${module}</strong><br>
                    <small>HTML: ${htmlPath}</small><br>
                    <small>JS: ${jsPath}</small>
                `;
                
                moduleList.appendChild(moduleItem);
            });
            
            document.getElementById('module-results').appendChild(moduleList);
            showResult('module-results', `‚úÖ Verificando ${expectedModules.length} m√≥dulos`, 'success');
        }

        // Probar rutas de navegaci√≥n
        function testNavigationRoutes() {
            clearResults('navigation-results');
            
            const routes = [
                '../pages/Inicio/Inicio.html',
                '../pages/Admission/AdmissionControl.html',
                '../pages/MasterTables/Companies.html',
                '../pages/MasterTables/Configuration.html',
                '../pages/MasterTables/District.html',
                '../pages/Audit/AuditRegistry.html',
                '../pages/Configuration/UsersManagement.html'
            ];

            routes.forEach(route => {
                const link = document.createElement('a');
                link.href = route;
                link.textContent = route;
                link.style.display = 'block';
                link.style.margin = '5px 0';
                link.style.color = '#007bff';
                link.target = '_blank';
                
                const container = document.getElementById('navigation-results');
                container.appendChild(link);
            });
            
            showResult('navigation-results', `‚úÖ ${routes.length} rutas de prueba generadas`, 'success');
        }

        // Mostrar estado del sistema
        function showSystemStatus() {
            clearResults('system-status');
            
            const status = {
                'Session Storage': {
                    'isLoggedIn': sessionStorage.getItem('isLoggedIn'),
                    'authToken': sessionStorage.getItem('authToken') ? 'Presente' : 'No presente',
                    'userPermissions': sessionStorage.getItem('userPermissions') || 'No definido'
                },
                'Global Objects': {
                    'PermissionsService': typeof window.PermissionsService !== 'undefined' ? 'Disponible' : 'No disponible',
                    'RouteGuard': typeof window.RouteGuard !== 'undefined' ? 'Disponible' : 'No disponible'
                },
                'Current Location': {
                    'pathname': window.location.pathname,
                    'hostname': window.location.hostname,
                    'protocol': window.location.protocol
                }
            };

            const pre = document.createElement('pre');
            pre.textContent = JSON.stringify(status, null, 2);
            document.getElementById('system-status').appendChild(pre);
            
            showResult('system-status', `üìä Estado del sistema generado`, 'info');
        }

        // Cargar PermissionsService al iniciar
        window.addEventListener('load', function() {
            // Intentar cargar el sistema de permisos
            const script = document.createElement('script');
            script.src = '../assets/js/auth/permissions.js';
            script.onload = function() {
                showResult('system-status', `‚úÖ PermissionsService cargado correctamente`, 'success');
            };
            script.onerror = function() {
                showResult('system-status', `‚ùå Error cargando PermissionsService`, 'error');
            };
            document.head.appendChild(script);
        });
    </script>
</body>
</html>
