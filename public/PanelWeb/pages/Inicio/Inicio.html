<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Configuración básica del documento -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Configuración de caché para prevenir almacenamiento de datos sensibles -->
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../../assets/Recourse/Logo/1.png">
    <link rel="shortcut icon" href="../../assets/Recourse/Logo/1.png">
    
    <title>Panel de Administración - Inicio</title>
    
    <!-- Tabler CSS Framework -->
    <link rel="stylesheet" href="../../assets/tabler/css/tabler.min.css">
    <link rel="stylesheet" href="../../assets/tabler/css/tabler-vendors.min.css">
    
    <!-- Hojas de estilo -->
    <link rel="stylesheet" href="../../assets/css/global-toast.css">
    <link rel="stylesheet" href="../../assets/css/sidebar.css">
    <link rel="stylesheet" href="../../assets/css/topbar.css">
    <link rel="stylesheet" href="../../assets/css/profile.css">
    
    <!-- Font Awesome para iconografía -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Configuración de la página -->
    <script>
        window.pageConfig = {
            activeSection: 'inicio', // Sección activa en el sidebar
            pageTitle: {
                icon: 'fas fa-home',
                text: 'Inicio'
            }
        };
    </script>
</head>
<body>
    <!-- Contenedor principal del layout -->
    <div class="page">
        <!-- Contenedor del sidebar - se carga dinámicamente -->
        <div id="sidebar-container"></div>

        <!-- Contenido principal usando estructura Tabler -->
        <div class="page-wrapper">
            <!-- Contenedor del topbar - se carga dinámicamente -->
            <div id="topbar-container"></div>
            
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <!-- Loading State del dashboard -->
                    <div id="dashboard-loading" class="text-center py-5">
                        <div class="d-flex justify-content-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Cargando...</span>
                            </div>
                        </div>
                        <div class="text-center">
                            <h3 class="mt-3">Cargando estadísticas...</h3>
                            <p class="text-muted">Obteniendo datos del sistema</p>
                        </div>
                    </div>

                    <!-- Error del dashboard -->
                    <div id="dashboard-error" class="alert alert-danger text-center" style="display: none;">
                        <div class="text-danger mb-3">
                            <i class="fas fa-exclamation-triangle fa-3x"></i>
                        </div>
                        <h4 class="alert-title">Error al cargar el dashboard</h4>
                        <div class="text-muted mb-3" id="dashboard-error-message">
                            No se pudieron obtener las estadísticas del sistema
                        </div>
                        <button class="btn btn-outline-danger" id="dashboard-error-retry">
                            <i class="fas fa-redo me-2"></i> Reintentar
                        </button>
                    </div>

                    <!-- Page Header con estructura Tabler -->
                    <div id="dashboard-content" style="display: none;">
                        <div class="row g-2 align-items-center">
                            <div class="col">
                                <h2 class="page-title">Dashboard del Sistema</h2>
                            </div>
                            <!-- Page title actions -->
                            <div class="col-auto ms-auto d-print-none">
                                <div class="btn-list">
                                    <button class="btn btn-outline-cyan" id="dashboard-refresh-btn" title="Actualizar datos">
                                        <i class="fas fa-sync-alt me-2"></i>
                                        Actualizar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Contenido del dashboard -->
            <div class="page-body">
                <div class="container-xl">
                    <!-- Grid de estadísticas principales con estructura Tabler -->
                    <div class="row row-deck row-cards mb-4" id="dashboard-stats-grid">
                        <!-- Las estadísticas se cargarán dinámicamente aquí -->
                        <!-- El controller generará cards usando clases Tabler -->
                    </div>

                    <!-- Grid de métricas secundarias con estructura Tabler -->
                    <div class="row row-deck row-cards">
                        <!-- Métrica de acceso web -->
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="2" y1="12" x2="22" y2="12"></line>
                                            <path d="M12 2a15.3 15.3 0 0 1 4 10a15.3 15.3 0 0 1 -4 10a15.3 15.3 0 0 1 -4 -10a15.3 15.3 0 0 1 4 -10z"></path>
                                        </svg>
                                        Acceso Web
                                    </h3>
                                    <div class="card-actions">
                                        <a href="#" class="btn-action">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M3 12a9 9 0 1 0 9 -9a9.75 9.75 0 0 0 -6.74 2.74l-4.26 4.26"></path>
                                                <path d="M12 3v9l4 -4"></path>
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                                <div class="card-body" id="web-access-metrics">
                                    <!-- Se carga dinámicamente por el controller -->
                                </div>
                            </div>
                        </div>

                        <!-- Métrica de distribución de roles -->
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="3" y="4" width="6" height="4" rx="1"></rect>
                                            <rect x="15" y="4" width="6" height="4" rx="1"></rect>
                                            <rect x="9" y="10" width="6" height="4" rx="1"></rect>
                                            <rect x="3" y="16" width="6" height="4" rx="1"></rect>
                                            <rect x="15" y="16" width="6" height="4" rx="1"></rect>
                                        </svg>
                                        Distribución del Sistema
                                    </h3>
                                    <div class="card-actions">
                                        <a href="#" class="btn-action">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M3 12a9 9 0 1 0 9 -9a9.75 9.75 0 0 0 -6.74 2.74l-4.26 4.26"></path>
                                                <path d="M12 3v9l4 -4"></path>
                                            </svg>
                                        </a>
                                    </div>
                                </div>
                                <div class="card-body" id="role-distribution">
                                    <!-- Se carga dinámicamente por el controller -->
                                </div>
                            </div>
                        </div>
                    </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Contenedor del modal - se carga dinámicamente -->
    <div id="modal-container"></div>

    <!-- Sistema de notificaciones toast -->
    <div id="toast" class="toast">
        <div id="toast-message">Página cargada correctamente</div>
    </div>

   <!-- Carga de scripts en orden específico para manejar dependencias -->
    <!-- 1. Component Loader (debe ir primero) -->
    <script src="../../assets/js/ui/component-loader.js"></script>
    
    <!-- 2. Utilidades y herramientas base -->
    <script src="../../assets/js/global-initializer.js"></script>
    <script src="../../assets/js/ui/global-toast.js"></script>
    <script src="../../assets/js/auth/permissions.js"></script>
    <script src="../../assets/js/auth/auth-checker.js"></script>
    <script src="../../assets/js/auth/route-guard.js"></script>
    
    <script>
        // Inicializa RouteGuard para proteger la página
        window.routeGuard = new RouteGuard("../../index.html");
    </script>
    
    <!-- 2. Servicios de API -->
    <script src="../../assets/js/api/services/profile-service.js"></script>
    <script src="../../assets/js/api/services/dashboard-service.js"></script>

    <!-- 3. Controladores de UI -->
    <script src="../../assets/js/ui/controllers/Components/sidebar-controller.js"></script>
    <script src="../../assets/js/ui/controllers/Components/topbar-controller.js"></script>
    <script src="../../assets/js/ui/controllers/Components/profile-controller.js"></script>
    <script src="../../assets/js/ui/controllers/dashboard-controller.js"></script>

    <!-- 4. Inicializador específico de la página -->
    <script src="../../assets/js/ui/initializers/inicio-initializer.js"></script>

    <!-- 5. Scripts de Tabler para funcionalidad completa -->
    <script src="../../assets/tabler/js/tabler.min.js"></script>

    <!-- Verificación de sistema de toast -->
    <script>
        // Verificar que el sistema de toast esté disponible
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔍 Verificando sistema de toast...');
            console.log('📢 window.showRecoveryToast disponible:', typeof window.showRecoveryToast);
            console.log('🎯 Elemento recovery-toast encontrado:', !!document.getElementById('recovery-toast'));
            
            // Test del toast al cargar la página
            if (typeof window.showRecoveryToast === 'function') {
                setTimeout(() => {
                    window.showRecoveryToast('Sistema de toast cargado correctamente', 'success');
                }, 2000);
            }
        });
    </script>

    <!-- Toast notification for profile operations -->
    <div id="recovery-toast" class="recovery-toast">
        <div class="recovery-toast-content">
            <i class="fas fa-check-circle"></i>
            <span id="recovery-toast-message">Operación completada correctamente</span>
        </div>
    </div>
</body>
</html>
